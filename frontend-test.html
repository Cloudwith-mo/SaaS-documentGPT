<!DOCTYPE html>
<html>
<head><title>Frontend Test</title></head>
<body>
<h1>DocumentGPT Frontend Test</h1>
<div id="test-results"></div>
<script>
async function testFrontendWorkflow() {
    const results = document.getElementById('test-results');
    results.innerHTML = '<p>Starting comprehensive frontend test...</p>';
    
    try {
        // Test 1: Upload API
        results.innerHTML += '<p>üîÑ Testing upload API...</p>';
        const uploadResponse = await fetch('https://9voqzgx3ch.execute-api.us-east-1.amazonaws.com/prod/upload', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ filename: 'frontend-test.txt', contentType: 'text/plain' })
        });
        
        if (!uploadResponse.ok) throw new Error(`Upload failed: ${uploadResponse.status}`);
        const uploadData = await uploadResponse.json();
        results.innerHTML += `<p>‚úÖ Upload API: DocId ${uploadData.docId}</p>`;
        
        // Test 2: Simulate file upload to S3
        const testContent = 'Amazon Web Services (AWS) was launched in 2006. It provides cloud computing services including EC2, S3, and Lambda.';
        results.innerHTML += '<p>üîÑ Simulating S3 upload...</p>';
        
        // Test 3: Process document
        results.innerHTML += '<p>üîÑ Testing document processing...</p>';
        const processResponse = await fetch('https://9voqzgx3ch.execute-api.us-east-1.amazonaws.com/prod/process-document', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                docId: uploadData.docId, 
                filename: 'frontend-test.txt', 
                content: testContent 
            })
        });
        
        if (!processResponse.ok) throw new Error(`Process failed: ${processResponse.status}`);
        const processData = await processResponse.json();
        results.innerHTML += `<p>‚úÖ Document Processing: ${processData.status} (${processData.chunks} chunks)</p>`;
        
        // Test 4: Chat without context
        results.innerHTML += '<p>üîÑ Testing chat without context...</p>';
        const chatResponse1 = await fetch('https://9voqzgx3ch.execute-api.us-east-1.amazonaws.com/prod/rag-chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ question: 'What is your name?' })
        });
        
        if (!chatResponse1.ok) throw new Error(`Chat failed: ${chatResponse1.status}`);
        const chatData1 = await chatResponse1.json();
        results.innerHTML += `<p>‚úÖ Chat (no context): hasContext=${chatData1.hasContext}</p>`;
        
        // Test 5: RAG Chat with context
        results.innerHTML += '<p>üîÑ Testing RAG chat with document context...</p>';
        const chatResponse2 = await fetch('https://9voqzgx3ch.execute-api.us-east-1.amazonaws.com/prod/rag-chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                question: 'When was AWS launched?', 
                docId: uploadData.docId 
            })
        });
        
        if (!chatResponse2.ok) throw new Error(`RAG Chat failed: ${chatResponse2.status}`);
        const chatData2 = await chatResponse2.json();
        results.innerHTML += `<p>‚úÖ RAG Chat: hasContext=${chatData2.hasContext}</p>`;
        results.innerHTML += `<p><strong>Answer:</strong> ${chatData2.answer}</p>`;
        
        // Test 6: Content display simulation
        results.innerHTML += '<p>üîÑ Testing content display logic...</p>';
        const mockFile = { name: 'test.txt', type: 'text/plain' };
        const mockContent = testContent;
        
        // Simulate the frontend logic for text display
        const isTextFile = mockFile.name.match(/\.(txt|md|json|js|py|html|css|xml|csv)$/i) || mockFile.name.endsWith('.txt');
        const displayContent = isTextFile ? mockContent.replace(/</g, '&lt;').replace(/>/g, '&gt;') : 'Not a text file';
        
        results.innerHTML += `<p>‚úÖ Content Display: ${isTextFile ? 'Text content ready for display' : 'Non-text file'}</p>`;
        results.innerHTML += `<div style="border:1px solid #ccc; padding:10px; margin:10px 0; font-family:monospace; white-space:pre-wrap;">${displayContent}</div>`;
        
        // Final result
        results.innerHTML += '<h2 style="color:green;">üéâ ALL TESTS PASSED - DocumentGPT is fully functional!</h2>';
        results.innerHTML += '<p><strong>Verified:</strong></p>';
        results.innerHTML += '<ul>';
        results.innerHTML += '<li>‚úÖ CORS headers working</li>';
        results.innerHTML += '<li>‚úÖ Upload API functional</li>';
        results.innerHTML += '<li>‚úÖ Document processing working</li>';
        results.innerHTML += '<li>‚úÖ Chat without context working</li>';
        results.innerHTML += '<li>‚úÖ RAG chat with context working</li>';
        results.innerHTML += '<li>‚úÖ Content display logic ready</li>';
        results.innerHTML += '</ul>';
        
    } catch (error) {
        results.innerHTML += `<p style="color:red;">‚ùå ERROR: ${error.message}</p>`;
        console.error('Test failed:', error);
    }
}

// Auto-run test
testFrontendWorkflow();
</script>
</body>
</html>