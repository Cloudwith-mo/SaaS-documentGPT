<!DOCTYPE html>
<html>
<head>
    <title>Reset Credentials - backup-unified</title>
    <style>
        body { font-family: system-ui; max-width: 600px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        .card { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h1 { color: #10b981; margin: 0 0 10px 0; }
        button { background: #10b981; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 5px; }
        button:hover { background: #059669; }
        button.danger { background: #ef4444; }
        button.danger:hover { background: #dc2626; }
        .status { margin-top: 20px; padding: 15px; border-radius: 8px; }
        .success { background: #d1fae5; color: #065f46; }
        .info { background: #dbeafe; color: #1e40af; }
        .warning { background: #fef3c7; color: #92400e; }
        pre { background: #f3f4f6; padding: 10px; border-radius: 6px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="card">
        <h1>üîÑ Reset Credentials</h1>
        <p>Reset your usage limits and data for <strong>backup-unified.html</strong></p>
        
        <button onclick="resetUsage()">Reset Usage Only (Chats/Docs)</button>
        <button onclick="resetAll()" class="danger">Reset Everything (Nuclear)</button>
        
        <div id="status"></div>
    </div>
    
    <script>
        function resetUsage() {
            const state = JSON.parse(localStorage.getItem('dgpt:state:v3') || '{}');
            
            const before = {
                chats: state.usage?.chats_used || 0,
                docs: state.docs?.length || 0
            };
            
            // Reset usage
            if (state.usage) {
                state.usage.chats_used = 0;
                state.usage.documents_uploaded = 0;
            }
            
            localStorage.setItem('dgpt:state:v3', JSON.stringify(state));
            
            showStatus('success', `
                <h3>‚úÖ Usage Reset!</h3>
                <p><strong>Before:</strong></p>
                <ul>
                    <li>Chats used: ${before.chats}</li>
                    <li>Documents: ${before.docs}</li>
                </ul>
                <p><strong>After:</strong></p>
                <ul>
                    <li>Chats used: 0</li>
                    <li>Documents: ${before.docs} (unchanged)</li>
                </ul>
                <p>‚úÖ Refresh backup-unified.html to see changes!</p>
            `);
        }
        
        function resetAll() {
            if (!confirm('‚ö†Ô∏è This will delete ALL your data (documents, chats, settings). Continue?')) {
                return;
            }
            
            const before = {
                state: localStorage.getItem('dgpt:state:v3'),
                settings: localStorage.getItem('dgpt:settings:v1'),
                guestId: localStorage.getItem('guest_id')
            };
            
            // Clear everything
            localStorage.removeItem('dgpt:state:v3');
            localStorage.removeItem('dgpt:settings:v1');
            localStorage.removeItem('guest_id');
            
            // Also clear old versions
            localStorage.removeItem('dgpt:state:v1');
            localStorage.removeItem('dgpt:state');
            localStorage.removeItem('documentgpt:state');
            
            showStatus('warning', `
                <h3>üî• Everything Reset!</h3>
                <p><strong>Cleared:</strong></p>
                <ul>
                    <li>‚úÖ All documents</li>
                    <li>‚úÖ All chat history</li>
                    <li>‚úÖ All settings</li>
                    <li>‚úÖ Usage counters</li>
                    <li>‚úÖ Guest ID</li>
                </ul>
                <p><strong>Backup (if needed):</strong></p>
                <pre>${JSON.stringify({
                    state: before.state ? 'saved' : 'none',
                    settings: before.settings ? 'saved' : 'none',
                    guestId: before.guestId || 'none'
                }, null, 2)}</pre>
                <p>üîÑ Refresh backup-unified.html to start fresh!</p>
            `);
        }
        
        function showStatus(type, html) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.innerHTML = html;
        }
        
        // Show current status on load
        window.onload = () => {
            const state = JSON.parse(localStorage.getItem('dgpt:state:v3') || '{}');
            const settings = JSON.parse(localStorage.getItem('dgpt:settings:v1') || '{}');
            
            showStatus('info', `
                <h3>üìä Current Status</h3>
                <p><strong>Usage:</strong></p>
                <ul>
                    <li>Chats used: ${state.usage?.chats_used || 0} / 50</li>
                    <li>Documents: ${state.docs?.length || 0} / 10</li>
                </ul>
                <p><strong>Settings:</strong></p>
                <ul>
                    <li>Theme: ${settings.theme || 'light'}</li>
                    <li>Journal Mode: ${settings.journalMode ? 'Yes' : 'No'}</li>
                    <li>Autosave: ${settings.autosaveMs || 3000}ms</li>
                </ul>
                <p><strong>User:</strong></p>
                <ul>
                    <li>Guest ID: ${localStorage.getItem('guest_id') || 'none'}</li>
                    <li>Type: ${state.user?.isGuest ? 'Guest' : 'Logged In'}</li>
                </ul>
            `);
        };
    </script>
</body>
</html>
